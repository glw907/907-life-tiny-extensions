{{/*
  Template: /layouts/guides/list.html
  Purpose: Shows posts tagged with the category from URL
  Example URLs: /guides/dumbphones/, /guides/parenting/
*/}}

{{ define "main" }}
<div class="archive">
  {{ $segments := split .RelPermalink "/" }}
  {{ $cat := index $segments 2 }}

  {{/* Determine icon and title based on category */}}
  {{ $guideCat := "" }}
  {{ $icon := "" }}
  {{ if eq $cat "dumbphones" }}
    {{ $guideCat = "Dumbphone Guides" }}
    {{ $icon = "fa-solid fa-phone" }}
  {{ else if eq $cat "companion-devices" }}
    {{ $guideCat = "Companion Device Guides" }}
    {{ $icon = "fa-laptop" }}
  {{ else if eq $cat "auxiliary-devices" }}
    {{ $guideCat = "Auxiliary Device Guides" }}
    {{ $icon = "fa-solid fa-screwdriver-wrench" }}
  {{ else if eq $cat "analog-tools" }}
    {{ $guideCat = "Analog Tools Guides" }}
    {{ $icon = "fa-solid fa-book-open" }}
  {{ else if eq $cat "software" }}
    {{ $guideCat = "Software Guides" }}
    {{ $icon = "fa-code" }}
  {{ else if eq $cat "parenting" }}
    {{ $guideCat = "Parenting Guides" }}
    {{ $icon = "fa-solid fa-children" }}
  {{ else if eq $cat "philosophy" }}
    {{ $guideCat = "Philosophy Guides" }}
    {{ $icon = "fa-solid fa-book" }}
  {{ else if eq $cat "research" }}
    {{ $guideCat = "Research Guides" }}
    {{ $icon = "fa-solid fa-flask" }}
  {{ else if eq $cat "social-friction" }}
    {{ $guideCat = "Social Friction Guides" }}
    {{ $icon = "fa-solid fa-users" }}
  {{ else if eq $cat "success-stories" }}
    {{ $guideCat = "Success Stories" }}
    {{ $icon = "fa-solid fa-star" }}
  {{ else if eq $cat "workarounds" }}
    {{ $guideCat = "Workarounds" }}
    {{ $icon = "fa-solid fa-wrench" }}
  {{ end }}

  <h2 class="p-name"><i class="fa-solid {{ $icon }}"></i>{{ $guideCat }}</h2>

  {{/* Filter posts that have this category tag */}}
  {{ $all := .Site.RegularPages }}
  {{ $list := where $all "Params.categories" "intersect" (slice $cat) }}

  {{ if gt (len $list) 0 }}
    <div class="posts h-feed">
      {{ range $list }}
        <div class="post-preview h-entry">
          <a href="{{ .Permalink }}" class="post-date u-url">
            <i class="fa-regular fa-calendar"></i>
            <time class="dt-published" datetime="{{ .Date.Format "2006-01-02 15:04:05 -0700" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
          </a>
          <h3 class="post-title p-name"><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
          <div class="p-summary">{{ .Summary }}</div>
        </div>
      {{ end }}
    </div>
  {{ else }}
    <p>No posts found in this category.</p>
  {{ end }}
</div>
{{ end }}
